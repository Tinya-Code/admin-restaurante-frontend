<!-- product-form.component.html -->
<div class="w-full max-w-2xl mx-auto p-4 sm:p-6 bg-white rounded-lg shadow-md">
  <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-gray-800">
    {{ isEditMode() ? 'Editar Producto' : 'Crear Nuevo Producto' }}
  </h2>

  <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="space-y-4 sm:space-y-6">
    <!-- Grid responsive para categoría y precio -->
    <div class="grid grid-cols-2  gap-4">
      <!-- Categoría -->
      <div>
        <label for="category_id" class="block text-sm font-medium text-gray-700 mb-2">
          Categoría <span class="text-red-500">*</span>
        </label>
        <select
          id="category_id"
          formControlName="category_id"
          class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
          [class.border-red-500]="categoryId?.invalid && categoryId?.touched"
        >
          <option value="">Selecciona</option>
          @for (category of categories(); track category.id) {
            <option [value]="category.id">{{ category.name }}</option>
          }
        </select>
        @if (categoryId?.invalid && categoryId?.touched) {
          <p class="mt-1 text-xs sm:text-sm text-red-500">La categoría es requerida</p>
        }
      </div>

      <!-- Precio -->
      <div>
        <label for="price" class="block text-sm font-medium text-gray-700 mb-2">
          Precio <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <span class="absolute left-3 top-2.5 text-gray-500 text-sm sm:text-base">S/</span>
          <input
            type="number"
            id="price"
            formControlName="price"
            step="0.01"
            min="0"
            placeholder="0.00"
            class="w-full pl-7 sm:pl-8 pr-3 sm:pr-4 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
            [class.border-red-500]="price?.invalid && price?.touched"
          />
        </div>
        @if (price?.invalid && price?.touched) {
          <div class="mt-1 text-xs sm:text-sm text-red-500">
            @if (price?.errors?.['required']) {
              <p>El precio es requerido</p>
            }
            @if (price?.errors?.['min']) {
              <p>El precio debe ser mayor a 0</p>
            }
          </div>
        }
      </div>
    </div>

    <!-- Nombre del Producto -->
    <div>
      <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
        Nombre del Producto <span class="text-red-500">*</span>
      </label>
      <input
        type="text"
        id="name"
        formControlName="name"
        placeholder="Ej: Laptop HP Pavilion"
        class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
        [class.border-red-500]="name?.invalid && name?.touched"
      />
      @if (name?.invalid && name?.touched) {
        <div class="mt-1 text-xs sm:text-sm text-red-500">
          @if (name?.errors?.['required']) {
            <p>El nombre es requerido</p>
          }
          @if (name?.errors?.['minlength']) {
            <p>El nombre debe tener al menos 3 caracteres</p>
          }
          @if (name?.errors?.['maxlength']) {
            <p>El nombre no puede superar 100 caracteres</p>
          }
        </div>
      }
    </div>

    <!-- Descripción -->
    <div>
      <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
        Descripción
      </label>
      <textarea
        id="description"
        formControlName="description"
        rows="4"
        placeholder="Describe el producto..."
        class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all"
        [class.border-red-500]="description?.invalid && description?.touched"
      ></textarea>
      @if (description?.errors?.['maxlength']) {
        <p class="mt-1 text-xs sm:text-sm text-red-500">
          La descripción no puede superar 500 caracteres
        </p>
      }
      <p class="mt-1 text-xs text-gray-500">{{ description?.value?.length || 0 }}/500 caracteres</p>
    </div>

    <!-- Imagen -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2"> Imagen del Producto </label>

      <!-- Preview de imagen -->
      @if (imagePreview()) {
        <div class="mb-4 relative rounded-lg overflow-hidden">
          <img
            [src]="imagePreview()!"
            alt="Preview"
            class="w-full h-48 sm:h-64 object-cover border border-gray-300"
          />
          <button
            type="button"
            (click)="removeImage()"
            class="absolute top-2 right-2 bg-red-500 text-white p-1.5 sm:p-2 rounded-full hover:bg-red-600 transition-colors shadow-lg"
            aria-label="Eliminar imagen"
          >
            <svg
              class="w-4 h-4 sm:w-5 sm:h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>
      }

      <!-- Input de archivo -->
      <div class="flex items-center justify-center w-full">
        <label
          for="image_file"
          class="flex flex-col items-center justify-center w-full h-28 sm:h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors"
        >
          <div class="flex flex-col items-center justify-center pt-4 pb-5 px-4">
            <svg
              class="w-8 h-8 sm:w-10 sm:h-10 mb-2 sm:mb-3 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
              ></path>
            </svg>
            <p class="mb-1 sm:mb-2 text-xs sm:text-sm text-gray-500 text-center">
              <span class="font-semibold">Click para subir</span>
              <span class="hidden sm:inline">o arrastra y suelta</span>
            </p>
            <p class="text-xs text-gray-500">PNG, JPG, GIF, WEBP (MAX. 5MB)</p>
          </div>
          <input
            id="image_file"
            type="file"
            class="hidden"
            accept="image/*"
            (change)="onFileSelected($event)"
          />
        </label>
      </div>
    </div>

    <!-- Disponibilidad -->
    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
      <span class="text-sm font-medium text-gray-700"> Producto disponible para la venta </span>
      <label class="relative inline-flex items-center cursor-pointer">
        <input type="checkbox" formControlName="is_available" class="sr-only peer" />
        <div
          class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"
        ></div>
      </label>
    </div>

    <!-- Botones -->
    <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 pt-4 border-t">
      <button
        type="submit"
        [disabled]="loading() || productForm.invalid"
        class="w-full sm:flex-1 px-6 py-3 bg-blue-600 text-white text-sm sm:text-base rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all font-medium shadow-sm hover:shadow-md"
      >
        @if (loading()) {
          <span class="flex items-center justify-center">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            Guardando...
          </span>
        } @else {
          {{ isEditMode() ? 'Actualizar Producto' : 'Crear Producto' }}
        }
      </button>

      <button
        type="button"
        (click)="onCancel()"
        [disabled]="loading()"
        class="w-full sm:w-auto px-6 py-3 bg-gray-200 text-gray-700 text-sm sm:text-base rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-all font-medium"
      >
        Cancelar
      </button>
    </div>
  </form>
</div>
